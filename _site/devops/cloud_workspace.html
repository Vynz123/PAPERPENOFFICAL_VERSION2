<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Cloud Workspace Automation Plan | Teacher 2.0</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Cloud Workspace Automation Plan" />
<meta name="author" content="aknowledgements to, Aadit Gupta , Tanisha Patil, ChatGPT" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The primary goal is to provide cloud-based Student Desktops for use in the classroom, accessed through District-issued Chromebooks. This cloud computing approach offers cost savings over traditional on-premise desktops and ensures rapid access to up-to-date hardware/software through cloud providers." />
<meta property="og:description" content="The primary goal is to provide cloud-based Student Desktops for use in the classroom, accessed through District-issued Chromebooks. This cloud computing approach offers cost savings over traditional on-premise desktops and ensures rapid access to up-to-date hardware/software through cloud providers." />
<link rel="canonical" href="http://localhost:4100/teacher_portfolio/devops/cloud_workspace" />
<meta property="og:url" content="http://localhost:4100/teacher_portfolio/devops/cloud_workspace" />
<meta property="og:site_name" content="Teacher 2.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-29T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cloud Workspace Automation Plan" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"aknowledgements to, Aadit Gupta , Tanisha Patil, ChatGPT"},"dateModified":"2023-07-29T00:00:00-07:00","datePublished":"2023-07-29T00:00:00-07:00","description":"The primary goal is to provide cloud-based Student Desktops for use in the classroom, accessed through District-issued Chromebooks. This cloud computing approach offers cost savings over traditional on-premise desktops and ensures rapid access to up-to-date hardware/software through cloud providers.","headline":"Cloud Workspace Automation Plan","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4100/teacher_portfolio/devops/cloud_workspace"},"url":"http://localhost:4100/teacher_portfolio/devops/cloud_workspace"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/teacher_portfolio/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4100/teacher_portfolio/feed.xml" title="Teacher 2.0" /><link rel="shortcut icon" type="image/x-icon" href="/teacher_portfolio/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/teacher_portfolio/">Teacher 2.0</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/teacher_portfolio/blogs/">Blogs</a><a class="page-link" href="/teacher_portfolio/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Cloud Workspace Automation Plan</h1><p class="page-description">The primary goal is to provide cloud-based Student Desktops for use in the classroom, accessed through District-issued Chromebooks. This cloud computing approach offers cost savings over traditional on-premise desktops and ensures rapid access to up-to-date hardware/software through cloud providers.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-07-29T00:00:00-07:00" itemprop="datePublished">
        Jul 29, 2023
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">aknowledgements to, Aadit Gupta , Tanisha Patil, ChatGPT</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      28 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
          <a class="category-tags-link" href="/teacher_portfolio/categories/cte#C7.0">C7.0</a>
        
        &nbsp;
      
          <a class="category-tags-link" href="/teacher_portfolio/categories/cte#C7.1">C7.1</a>
        
        &nbsp;
      
          <a class="category-tags-link" href="/teacher_portfolio/categories/cte#C7.2">C7.2</a>
        
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody"><ul><li><a href="#desktop-usage">Desktop Usage</a><ul><li><a href="#monthly-servicesbreakdown">Monthly Services/Breakdown</a></li><li><a href="#daily-usage">Daily Usage</a></li><li><a href="#usage-patterns">Usage Patterns</a></li><li><a href="#server--user-last-session">Server / User Last Session</a></li></ul></li><li><a href="#automation-planning">Automation Planning</a><ul><li><a href="#setup-requirements-part-1---system-setup">Setup Requirements (Part 1 - System Setup)</a><ul><li><a href="#aws-ec2-instances">AWS EC2 Instances</a></li><li><a href="#pool-of-kasm-workspaces">Pool of Kasm workspaces</a></li></ul></li><li><a href="#setup-requirements-part-2---networking">Setup Requirements (Part 2 - Networking)</a><ul><li><a href="#aws-ec2-elastic-ips-permanent-ips">AWS EC2 elastic IPs, permanent ips</a></li><li><a href="#aws-route-53-kasm-dns-names-to-elastic-ips-plan">AWS Route 53, Kasm DNS names to elastic IPs plan</a></li><li><a href="#route-53-sample-from-aws">Route 53 Sample from AWS</a></li><li><a href="#terrform-route-53-reference">Terrform Route 53 reference</a></li><li><a href="#nginx-configuration-to-reverse-proxy-kasm-dns-name-to-port">Nginx configuration to reverse proxy Kasm DNS name to port</a></li><li><a href="#certbot-certificates-for-dns-name-to-https">Certbot certificates for DNS name to HTTPs</a></li></ul></li><li><a href="#setup-requirements-part-3---kasm-workspaces">Setup Requirements (Part 3 - Kasm workspaces)</a></li></ul></li><li><a href="#automation-terraform-and-aws-cli">Automation Terraform and AWS CLI</a><ul><li><a href="#terraform-architecture">Terraform Architecture</a></li><li><a href="#terraform-test-plan">Terraform Test plan</a><ul><li><a href="#1st-stage---ec2-instances-only">1st Stage - EC2 Instances Only:</a></li><li><a href="#2nd-stage---ec2-instances-and-route-53-records">2nd Stage - EC2 Instances and Route 53 Records:</a></li><li><a href="#3rd-stage---ec2-instances-route-53-records-and-nginx-configurations">3rd Stage - EC2 Instances, Route 53 Records, and Nginx Configurations:</a></li></ul></li><li><a href="#version-control-of-terraform-files">Version Control of Terraform files</a><ul><li><a href="#terraform-file-provision">Terraform file provision</a></li></ul></li><li><a href="#security-and-workspace-assignment">Security and Workspace Assignment:</a><ul><li><a href="#student-login-management">Student login management</a></li><li><a href="#student-database">Student database</a></li><li><a href="#references">References</a></li></ul></li><li><a href="#kasm-workspace-architecture">Kasm workspace Architecture:</a><ul><li><a href="#kasm-requires-a-registory-for-workspaces">Kasm requires a Registory for workspaces:</a></li><li><a href="#kasm-workspaces-docker-layout">Kasm workspaces Docker layout</a></li><li><a href="#kasm-workspaces-have-tool-requirements">Kasm workspaces have tool requirements</a></li></ul></li></ul></li><li><a href="#tbd-plans">TBD Plans</a><ul><li><a href="#web-filtering-policy">Web Filtering Policy</a></li><li><a href="#user-database-security-and-feature">User Database Security and Feature</a></li><li><a href="#review-aws-security">Review AWS Security:</a></li><li><a href="#terraform-life-cycle">Terraform Life Cycle:</a></li><li><a href="#investage-and-move-to-kasm-multi-server">Investage and move to Kasm multi-server</a></li></ul></li></ul><h2 id="desktop-usage">Desktop Usage</h2>

<p>Primarily, most students have brought their own laptop to school (MacOs or Windows).  To provide access to all students, the AWS/Kasm Cloud Desktop solution was created.  These Fall 2023 numbers reflect the usage of cloud computers.  For the year we have had 43 users, 34 remain active.  Cloud computing requests have been both temporary and permanent.</p>

<table>
  <thead>
    <tr>
      <th>Class/Section</th>
      <th>Periods</th>
      <th>Classroom(s)</th>
      <th>Number of Students</th>
      <th>Cloud Desctop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AP Computer Science A</td>
      <td>2</td>
      <td>A101</td>
      <td>60</td>
      <td>3</td>
    </tr>
    <tr>
      <td>AP Computer Science Principles</td>
      <td>4</td>
      <td>A101,A153</td>
      <td>150</td>
      <td>23</td>
    </tr>
    <tr>
      <td>AP Computer Science Software Engineering</td>
      <td>2</td>
      <td>A153</td>
      <td>44</td>
      <td>17</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Cloud Computing</code>  Traditionally, classrooms have been serviced by on premise desktops; costs can be high, and the aging of machines can be rapid. The purpose of this project is to create workspaces, similar to laptops/desktops, but in the cloud. The students would use their District issued Chromebook to access these cloud workspaces, which would enable them to perform coding work in their Computer Science Pathway.   The early cost number analysis has indicated that this could be much more affordable in a 5 year cycle, plus aging amd maintenace of equipment is now outsourced to the cloud provider.</p>

<h3 id="monthly-servicesbreakdown">Monthly Services/Breakdown</h3>
<p>This shows total cost of about 2 machines per year. 10 months x $500 = $5000</p>

<p><img src="/teacher_portfolio/images/aws_cost.png" alt="cost_month" /></p>

<h3 id="daily-usage">Daily Usage</h3>
<p>This shows ramp up ‘till mid August, cost savings from turning off machines 12-midnight to 6am on September 9th, and then adding other educational services on September 19th.  Last day is always partial</p>

<p><img src="/teacher_portfolio/images/aws_daily_cost.png" alt="cost_day" /></p>

<h3 id="usage-patterns">Usage Patterns</h3>
<p>In existing Kasm configuration, single server, there is intent to have no more than 3 active users on a single server machine.</p>

<p>Graph show usage of 1 of 11 machines in network from Thu morning to Sat morning.</p>

<ul>
  <li>Peaks are during Thursday and Friday class time</li>
  <li>There is a Thu night “homework” access, showing home access</li>
  <li>Friday night to Saturday have no usage</li>
</ul>

<p><img src="/teacher_portfolio/images/aws_kasm_usage.png" alt="usage" /></p>

<h3 id="server--user-last-session">Server / User Last Session</h3>
<p>This first table show last sessions on kasm101.  All during school hours.</p>

<table>
  <thead>
    <tr>
      <th>Server</th>
      <th>Username</th>
      <th>Last Session</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>kasm101</td>
      <td>arnavnadar</td>
      <td>2023-09-29 14:31:38</td>
    </tr>
    <tr>
      <td>kasm101</td>
      <td>zidaneahmed01</td>
      <td>2023-09-29 11:20:10</td>
    </tr>
    <tr>
      <td>kasm101</td>
      <td>adibricks</td>
      <td>2023-09-29 09:55:54</td>
    </tr>
  </tbody>
</table>

<p>This table shows that only two sessions of the 11 machines and 34 users were established on Friday night.  Showing that system could be optimized by using multi-server and establishing servers according to demand.</p>

<table>
  <thead>
    <tr>
      <th>Server</th>
      <th>Username</th>
      <th>Last Session</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>kasm200</td>
      <td>noratheturtle</td>
      <td>2023-09-29 21:47:04</td>
    </tr>
    <tr>
      <td>kasm104</td>
      <td>deanphillips24</td>
      <td>2023-09-29 20:14:53</td>
    </tr>
    <tr>
      <td>kasm202</td>
      <td>tanisha</td>
      <td>2023-09-29 14:45:40</td>
    </tr>
    <tr>
      <td>kasm203</td>
      <td>ashwinv93</td>
      <td>2023-09-29 14:34:09</td>
    </tr>
    <tr>
      <td>kasm301</td>
      <td>jasonguan1012</td>
      <td>2023-09-29 14:33:26</td>
    </tr>
  </tbody>
</table>

<h2 id="automation-planning">Automation Planning</h2>
<p>This automation plan set out to create cloud-based AWS EC2’s and provision them with Kasm workspaces.  After many experiments with manual configurations, a recipe for servers and tools was created. The recipe was converted to Terraform plans and Kasm/Docker containers to produce cloud-desktops to meet Computer Science tools needs.</p>

<p>The automation process involves setting up AWS EC2 instances with Ubuntu Linux images and provisioning them with Kasm workspaces. <code class="language-plaintext highlighter-rouge">A Kasm workspace</code>, built on docker containers, <code class="language-plaintext highlighter-rouge">provides an operating system, desktop environment, and software development tools for the Computer Science classroom students</code>.</p>

<p><code class="language-plaintext highlighter-rouge">Automating Cloud Setups</code>  The following illustration assumes a <code class="language-plaintext highlighter-rouge">Terraform</code> recipe being pushed to each <code class="language-plaintext highlighter-rouge">AWS EC2</code>, the EC2 instances are provisioned with <code class="language-plaintext highlighter-rouge">Ubuntu Linux</code> images.   The names <code class="language-plaintext highlighter-rouge">Kasm1.ncs.com, Kasm2.ncs.com, ...</code> represent cloud machines connected to a <code class="language-plaintext highlighter-rouge">Kasm registry</code>, the registry is a means of providing containerized desktop software.  Each image + Kasm containerized software provides an <code class="language-plaintext highlighter-rouge">operating system</code>, <code class="language-plaintext highlighter-rouge">desktop environment</code>, and <code class="language-plaintext highlighter-rouge">software development tools</code>.</p>

<p>Diagram illustrating AWS EC2 instances with Kasm workspaces</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            AWS EC2 Ubuntu Linux instances (1 to N)
            ----------------------------------------
            |-&gt; Kasm1.ncs.com 5 logins/3 sessions &lt;-|
            |                                       |
            |-&gt; Kasm2.ncs.com 5 logins/3 sessions &lt;-|
Terraform--&gt;|                                       |&lt;-&gt;Kasm
 (recipe)   |-&gt; Kasm3.ncs.com 5 logins/3 sessions &lt;-| workspace
            |                                       |
            |-&gt; Kasm4.ncs.com 5 logins/3 sessions &lt;-|
            |                                       |
            |-&gt; KasmN.ncs.com 5 logins/3 sessions &lt;-|
            ^ ------------------------------------- ^
            ^                                       ^
         AWS CLI                               Kasm Registry
           VPC                                     HTTP        
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Terraform recipe</code>  The term <code class="language-plaintext highlighter-rouge">recipe</code> is used to describe all the elements needed to build the AWS EC2 Ubunto images.  Terraform is the tool that drives the process, AWS CLI is tool chain that delivers the content.  A Terraform recipe, as in a cooking recipe, has many steps, intermediate processes, and outcomes.  These steps, processes, and outcomes are detailed and form the majority of the content in this document.</p>

<p><code class="language-plaintext highlighter-rouge">Kasm workspace</code>  In this context, the term <code class="language-plaintext highlighter-rouge">workspace</code> is used to describe the process of defining and delivering a computing environment that users can use to access a simulated desktop and development applications.  Kasm registry is a distribution marketplace that works over HTTP.  A workspace is defined by a Docker/DevOps engineer and is distributed as a Docker container, a workspace recipe, through the Kasm registry. A workpace adminstrator installs Kasm workspace on the Kasm instance.  The installed Kasm workspace, after installation, can be run by a user to initiate a session on the AWS EC2 Ununtu Linux instance.</p>

<p><code class="language-plaintext highlighter-rouge">Scaling and Management</code>  To scale the number of students using the workspaces, each machine can have up to <code class="language-plaintext highlighter-rouge">5 user logins</code> per instance (for free license), but based on resources consumed, it would adequately serve <code class="language-plaintext highlighter-rouge">3 active sessions</code>.  There are many additional Terraform, AWS and/or Kasm features to allocate resources, scale resources, and timeout inactive workspace sessions.  Additionally, <code class="language-plaintext highlighter-rouge">machines can be put to sleep</code>, for instance 12am to 6am daily to save on cost;<code class="language-plaintext highlighter-rouge">woken up</code> based off of demand weekends and holidays.  All the machines are on a AWS Virtual Private Cloud (VPC), in this type of an environment Amazon has provided many additional tools and process to manage usage and control costs.</p>

<h3 id="setup-requirements-part-1---system-setup">Setup Requirements (Part 1 - System Setup)</h3>
<p><code class="language-plaintext highlighter-rouge">System setup</code> These are features requirements that get the Kasm system running on AWS EC2 Ubuntu.  The following specifications have been captured by a proof of concept analysis.  Terraform is the selected tool for building recipes, AWS is the infrastructure, and GitHub will be used for version control.</p>

<h4 id="aws-ec2-instances">AWS EC2 Instances</h4>
<p>AWS instances are spread over 3 regions.  By default, AWS only allows 5 public IP addresses per region. Because of this limitation, this inital configuration uses 3 regions to obtain 11 machines to server 33 simultaneous users.  This limitation would be overcome by refactoring to multi-server Kasm configuration.</p>

<p>To set up the first 5 AWS EC2 instances, we will use the following specifications:</p>
<ul>
  <li>Region Oregon (us-west-2)</li>
  <li>Instance t2.medium (2 x CPU, 4 Gib RAM)</li>
  <li>Architecture x86</li>
  <li>Use “Kasm” key pair in Oregon VPC</li>
  <li>Storage 60 Gib gp3 general purpose SD</li>
  <li>Allow SSH, HTTP, HTTPS</li>
</ul>

<p>To setup next 4 AWS EC2 instance, we will use the same configuration with the following modifications.</p>
<ul>
  <li>Region N. Virginia (us-east-1)</li>
  <li>Instance t2.medium (2 x CPU, 4 Gib RAM), but identier is specific to VPC</li>
  <li>Use “Kasm” key pair in N. Viginia VPC</li>
</ul>

<p>To setup final 2 AWS EC2 instance, we will use the same configuration with the following modifications.  Note, cost is slightly more expensive using California.</p>
<ul>
  <li>Region N.California (us-west-1)</li>
  <li>Instance t2.medium (2 x CPU, 4 Gib RAM), but identier is specific to VPC</li>
  <li>Use “Kasm” key pair in N.California VPC</li>
</ul>

<h4 id="pool-of-kasm-workspaces">Pool of Kasm workspaces</h4>
<p>Additionally, we will install Kasm version 1.13.1 using the provided scripting commands.  We will have a pool of servers <code class="language-plaintext highlighter-rouge">kasm10&lt;N&gt;</code>, <code class="language-plaintext highlighter-rouge">kasm20&lt;N&gt;</code>, <code class="language-plaintext highlighter-rouge">kasm30&lt;N&gt;</code>.  The pool of servers required is based of off the number of Users divided by 5.  Each kasm instance will only support 5 users, 3 simulaneous access.</p>

<p>To perform proof of concept we will build kasm workspace (<code class="language-plaintext highlighter-rouge">kasm100</code> to <code class="language-plaintext highlighter-rouge">kasm104</code><code class="language-plaintext highlighter-rouge">, </code>kasm200<code class="language-plaintext highlighter-rouge"> to </code>kasm2003<code class="language-plaintext highlighter-rouge">, </code>kasm300<code class="language-plaintext highlighter-rouge"> to </code>kasm301<code class="language-plaintext highlighter-rouge">). The </code>kasm101` machine is used to test the features Kasm workspaces with the automated installs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Reference: https://Kasmweb.com/docs/latest/install/single_server_install.html</span>
<span class="nb">cd</span> /tmp
curl <span class="nt">-O</span> https://Kasm-static-content.s3.amazonaws.com/Kasm_release_1.13.1.421524.tar.gz
<span class="nb">tar</span> <span class="nt">-xf</span> Kasm_release_1.13.1.421524.tar.gz

<span class="c"># Automate prompts for EULA, Swap Partition,and Port</span>
<span class="nb">sudo </span>bash Kasm_release/install.sh <span class="nt">--accept-eula</span> <span class="nt">--swap-size</span> 8192 <span class="nt">-L</span> 8443
</code></pre></div></div>

<h3 id="setup-requirements-part-2---networking">Setup Requirements (Part 2 - Networking)</h3>
<p><code class="language-plaintext highlighter-rouge">Networking</code> To enable user-friendly internet access, we will allocate AWS EC2 elastic IPs and set up DNS subdomains using AWS Route 53. Nginx will be configured to reverse proxy requests to the appropriate Kasm workspaces.</p>

<p>Note, qw have enabled setup and verification of these steps in Terraform.</p>

<h4 id="aws-ec2-elastic-ips-permanent-ips">AWS EC2 elastic IPs, permanent ips</h4>
<p>Each AWS EC2 Ubuntu Kasm instance requires a Virtual Private Cloud VPC elastic IP address.  This will result in allocation of IP address that needs to be assigned to server.</p>
<ul>
  <li>Region: Oregon (us-west-2)</li>
  <li>Name: Kasm1</li>
  <li>Allocation ID: i-0ef40a9caee208041 (Kasm1 ec2 instance ID)</li>
</ul>

<h4 id="aws-route-53-kasm-dns-names-to-elastic-ips-plan">AWS Route 53, Kasm DNS names to elastic IPs plan</h4>
<p>AWS Route 53 requires setting up a DNS subdomain for each Kasm server elastic ip address.  This example shows description of keys and values used in Route 53.</p>
<ul>
  <li>Hosted Zone: nighthawkcodingsociety.com</li>
  <li>Record Name: Kasm100.nighthawkcodingsociety.com</li>
  <li>Type: A</li>
  <li>Routing Policy: Simple</li>
  <li>Alias: No</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Value/Route traffic to: 35.165.133.250</td>
          <td>300</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>TTL (seconds): 300</li>
</ul>

<p>Illustrate Domain Name Service (DNS)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|--------------------------------------&gt;|
| Request, client asks                  |
|  "kasm100.nighthawkcodingsociety.com" |
|--------------------------------------&gt;|
|         Bidirectional map             |
|--------------------------------------&gt;|
|  Response, DNS resolve                |
|   "100.21.190.187"                    |
|&lt;--------------------------------------|
</code></pre></div></div>

<p>Illustrate using <code class="language-plaintext highlighter-rouge">dig</code> to request</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dig Kasm100.nighthawkcodingsociety.com 

<span class="p">;</span> &lt;&lt;<span class="o">&gt;&gt;</span> DiG 9.10.6 &lt;&lt;<span class="o">&gt;&gt;</span> Kasm100.nighthawkcodingsociety.com
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="o">&lt;&lt;-</span> <span class="no">opcode</span><span class="sh">: QUERY, status: NOERROR, id: 9961
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;Kasm100.nighthawkcodingsociety.com. IN	A

;; ANSWER SECTION:
Kasm100.nighthawkcodingsociety.com. 300	IN A	35.165.133.250

;; Query time: 123 msec
;; SERVER: 2603:8001:4f00:4079::1#53(2603:8001:4f00:4079::1)
;; WHEN: Sat Sep 30 19:15:13 PDT 2023
;; MSG SIZE  rcvd: 79

</span></code></pre></div></div>

<h4 id="route-53-sample-from-aws">Route 53 Sample from AWS</h4>
<p>|Record name|Type|Routing policy|Differentiator|Alias|Value/Route traffic to|TTL|
|———–|—-|————–|————–|—–|———————-|—|
|kasm100.nighthawkcodingsociety.com|A|Simple|-|No|35.165.133.250|300|
|kasm201.nighthawkcodingsociety.com|A|Simple|-|No|18.211.176.115|300|
|kasm300.nighthawkcodingsociety.com|A|Simple|-|No|54.193.89.2|300|</p>

<h4 id="terrform-route-53-reference">Terrform Route 53 reference</h4>
<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record.html">Terraform aws_route53_record reference</a></p>

<h4 id="nginx-configuration-to-reverse-proxy-kasm-dns-name-to-port">Nginx configuration to reverse proxy Kasm DNS name to port</h4>
<p>Nginx needs to be configured to route Kasm1.nighthawkcodingsociety.com request to port 8443.</p>
<ul>
  <li>FYI, port can be setup with -L option during automated Kasm install.</li>
</ul>

<p>Nginx needs to be installed on EC2 instance.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>nginx
</code></pre></div></div>

<p>Illustrate Nginx to Kasm workspace</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nginx Request:        Reverse Proxy Pass:      Kasm Workspace
"kasm1.ncs.com"  ----&gt; https://localhost:8443     Endpoint:
    ^                           |                     ^
    |                           |                     |
    |     requsts               |                     |
    |&lt;-------------------------&gt;|      proxy          |
          responses             |&lt;-------------------&gt;|
                              
</code></pre></div></div>

<p>Nginx Request: Represents the initial request from the client to access the Kasm workspace using the domain name “kasm1.nighthawkcodingsociety.com.”, abbreviated as “kasm1.ncs.com” in illustration</p>

<p>Reverse Proxy Pass: Indicates the role of Nginx as a reverse proxy, forwarding the request to the appropriate Kasm workspace endpoint.</p>

<p>Kasm Workspace Endpoint: Represents the endpoint of the Kasm workspace (application), accessible through HTTPS on port 8443.</p>

<h4 id="certbot-certificates-for-dns-name-to-https">Certbot certificates for DNS name to HTTPs</h4>
<p>Certbot providesfree certificates to application endpoints that serve their content over HTTPS</p>

<p>Install Certbot</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>snap <span class="nb">install </span>core<span class="p">;</span> <span class="nb">sudo </span>snap refresh core
<span class="nb">sudo </span>snap <span class="nb">install</span> <span class="nt">--classic</span> certbot
<span class="nb">sudo ln</span> <span class="nt">-s</span> /snap/bin/certbot /usr/bin/certbot
</code></pre></div></div>

<p>Assign certificate to nginx hosts.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>certbot <span class="nt">--nginx</span> <span class="nt">--non-interactive</span> <span class="nt">--agree-tos</span> <span class="nt">-m</span> Kasm1.nighthawkcodingsociety.com
</code></pre></div></div>

<h3 id="setup-requirements-part-3---kasm-workspaces">Setup Requirements (Part 3 - Kasm workspaces)</h3>
<p><code class="language-plaintext highlighter-rouge">Kasm workspaces</code> will be defined and delivered as Docker containers through the Kasm registry.  For Terraform automation the primary requirement is to add a registry to the default configuration that point to the Del Norte HS registry …</p>

<p>GitHub Registry location:  https://nighthawkcoders.github.io/kasm_registry/1.0/</p>

<h2 id="automation-terraform-and-aws-cli">Automation Terraform and AWS CLI</h2>
<p>To manage the automation, we will install Terraform and AWS CLI. The AWS CLI will be configured with AWS credentials, and we will verify access to AWS services using sts, s3, and s3api commands.</p>

<p>Tool installation and verification.  This is a preparation step prior to using Terraform. Below are commands to configure Amazon Web Service Command Line Interface <code class="language-plaintext highlighter-rouge">awscli</code>, verify configuration <code class="language-plaintext highlighter-rouge">sts</code>, and test the Simple Storage Service <code class="language-plaintext highlighter-rouge">s3</code> and <code class="language-plaintext highlighter-rouge">s3api</code>.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Terraform</code> is a tool that lets you build, change, and version cloud resources safely and efficiently.</li>
  <li><code class="language-plaintext highlighter-rouge">AWS CLI</code> (Amazon Web Service Command Line Interface) is a tool to manage your AWS services.</li>
</ul>

<p>The steps below are simple instructions to install, setup, and verify these automation tools on your desktop.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 
# Automation key tools
</span><span class="err">$</span> <span class="n">brew</span> <span class="n">install</span> <span class="n">terraform</span>
<span class="err">$</span> <span class="n">brew</span> <span class="n">install</span> <span class="n">awscli</span>  

<span class="c1"># Credentials setup (~/.aws/credentials)
</span><span class="err">$</span> <span class="n">aws</span> <span class="n">configure</span>  <span class="c1"># prompts with keys. user adds values values
# Find User Access Keys in AWS IAM, answer as follows 
</span><span class="o">&lt;&lt;</span><span class="n">dialog</span> <span class="c1">#begin
</span><span class="n">AWS</span> <span class="n">Access</span> <span class="n">Key</span> <span class="n">ID</span> <span class="p">[</span><span class="o">****************</span><span class="n">PQML</span><span class="p">]:</span>
<span class="n">AWS</span> <span class="n">Secret</span> <span class="n">Access</span> <span class="n">Key</span> <span class="p">[</span><span class="o">****************</span><span class="n">Smcy</span><span class="p">]:</span>
<span class="n">Default</span> <span class="n">region</span> <span class="n">name</span> <span class="p">[</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
<span class="n">Default</span> <span class="n">output</span> <span class="nb">format</span> <span class="p">[</span><span class="n">json</span><span class="p">]:</span>
<span class="n">dialog</span> <span class="c1">#end
</span>
<span class="c1"># Credentials verification with Security Token Service (sts)
</span><span class="err">$</span> <span class="n">aws</span> <span class="n">sts</span> <span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span>
<span class="c1"># Notice return of IAM user
</span><span class="o">&lt;&lt;</span><span class="n">stsoutput</span> <span class="c1">#begin
</span>
  <span class="n">UserId</span><span class="p">:</span> <span class="o">****************</span><span class="mi">2</span><span class="n">B6D7</span>
  <span class="n">Account</span><span class="p">:</span> <span class="o">******</span><span class="mi">879144</span><span class="p">,</span>
  <span class="n">Arn</span><span class="p">:</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="o">******</span><span class="mi">879144</span><span class="p">:</span><span class="n">user</span><span class="o">/</span><span class="n">j</span><span class="o">***</span><span class="mi">21</span>

<span class="n">stsoutput</span> <span class="c1">#ends
</span>
<span class="c1"># Verify access to view a service, using s3 - 
</span><span class="err">$</span> <span class="n">aws</span> <span class="n">s3</span> <span class="n">ls</span>
<span class="c1"># This is a list of s3 buckets, notice terra-auto directory
</span><span class="o">&lt;&lt;</span><span class="n">s3output</span> <span class="c1">#begin
</span><span class="mi">2022</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">28</span> <span class="mi">13</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">43</span> <span class="n">aws</span><span class="o">-</span><span class="n">cloudtrail</span><span class="o">-</span><span class="n">logs</span><span class="o">-</span><span class="mi">542024879144</span><span class="o">-</span><span class="mi">84383535</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">09</span> <span class="mi">07</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">27</span> <span class="n">elasticbeanstalk</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">542024879144</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">25</span> <span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">32</span> <span class="n">loginzeen</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">19</span> <span class="mi">01</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">48</span> <span class="n">prehistoric</span><span class="o">-</span><span class="n">pals</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">31</span> <span class="mi">14</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">25</span> <span class="n">terra</span><span class="o">-</span><span class="n">auto</span>
<span class="n">s3output</span> <span class="c1">#ends
</span>
<span class="c1"># Verify and play with commands to write to a service, using s3api
</span><span class="err">$</span> <span class="n">aws</span> <span class="n">s3api</span> <span class="nb">list</span><span class="o">-</span><span class="n">objects</span> <span class="o">--</span><span class="n">bucket</span> <span class="n">terra</span><span class="o">-</span><span class="n">auto</span>
<span class="err">$</span> <span class="n">aws</span> <span class="n">s3api</span> <span class="n">put</span><span class="o">-</span><span class="nb">object</span> <span class="o">--</span><span class="n">bucket</span> <span class="n">terra</span><span class="o">-</span><span class="n">auto</span> <span class="o">--</span><span class="n">key</span> <span class="n">myfile</span><span class="p">.</span><span class="n">py</span>
<span class="err">$</span> <span class="n">aws</span> <span class="n">s3api</span> <span class="nb">list</span><span class="o">-</span><span class="n">objects</span> <span class="o">--</span><span class="n">bucket</span> <span class="n">terra</span><span class="o">-</span><span class="n">auto</span>
</code></pre></div></div>

<h3 id="terraform-architecture">Terraform Architecture</h3>
<p>This breakdown shows the hierarchical relationship between the variables, main module and its sub-modules. The main module calls the EC2, Kasm, Networking, Security, etc. to set up key portions of system.</p>

<p>Terraform Module Breakdown for EC2 Instances and Kasm Workspaces</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#0. Variables
|---&gt; Centralizes Configuration Settings
|---&gt; Defines Input Variables Used Across Sub-Modules

#1. Main (Root Module)
|---&gt; Creates AWS EC2 Instances
|---&gt; Configures inbound traffic, sets up elastic ips
|---&gt; Installs Kasm and network tools on EC2

#2. Network.tf
|---&gt; Sets Up DNS in Route 53

#3. Nginx
|---&gt; Configure nginx template through file provision
|---&gt; Moves nginx.conf file into appropriate system location
|---&gt; Depends on main.tf and network.tf

#4. Future, Security and Workspace setups
|---&gt; Defines Kasm roles, Policies, and Security Groups
|---&gt; Input Variables: permissions, security_groups, etc.
|---&gt; Round-robin user population across instances (Terraform?)

#5. Reboot
|---&gt; Checks that resources have been created, depends on nginx.tf
|---&gt; Performs reboot, validates services are activated
</code></pre></div></div>

<h3 id="terraform-test-plan">Terraform Test plan</h3>

<h4 id="1st-stage---ec2-instances-only">1st Stage - EC2 Instances Only:</h4>
<p>Create a folder for your test (e.g., stage1).</p>
<ul>
  <li>Place your variable.tf and main.tf files in the folder.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform init</code> to initialize the project.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform plan</code> to see what resources will be created.</li>
  <li>If the plan looks good, run terraform apply to create the EC2 instances.</li>
  <li>Manually check the AWS Management Console to ensure that the EC2 instances are created with the correct tags and elastice IPs.</li>
  <li>Terraform provides the <code class="language-plaintext highlighter-rouge">terraform destroy</code> command, which you can use to destroy all the resources created by a specific Terraform configuration. Run this before moving on to next test.</li>
  <li>Check that created EC2’s and Elastic IPs are gone.</li>
</ul>

<h4 id="2nd-stage---ec2-instances-and-route-53-records">2nd Stage - EC2 Instances and Route 53 Records:</h4>
<p>Create a new folder for this test (e.g., stage2).</p>
<ul>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform init</code> in this folder.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform plan</code> to see what resources will be created.</li>
  <li>If the plan looks good, run terraform apply to create the Route 53 records.</li>
  <li>Manually check the AWS Management Console to ensure that the Route 53 records are created correctly.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform destroy</code></li>
  <li>Check that created EC2’s and Elastic IPs are gone.</li>
</ul>

<h4 id="3rd-stage---ec2-instances-route-53-records-and-nginx-configurations">3rd Stage - EC2 Instances, Route 53 Records, and Nginx Configurations:</h4>
<p>Run final test from version control folder.</p>
<ul>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform init</code> in this folder.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform plan</code> to see what resources will be created.</li>
  <li>If the plan looks good, run terraform apply to create the Nginx configurations.</li>
  <li>Manually check the AWS Management Console to ensure that the Nginx configurations are created in correct location.</li>
  <li>Test access of each EC2 instance from internet (eg. kasm2.nighthawkcodingsociety.com)</li>
  <li>Test access to Kasm workspaces by logging in.</li>
  <li>Leave these running and start testing Kasm registry and workspaces if all is well.</li>
</ul>

<h3 id="version-control-of-terraform-files">Version Control of Terraform files</h3>
<p>At the very start of the project, we would like to use version control for all the Terraform elements.  Long term we would expect to have a <code class="language-plaintext highlighter-rouge">frontend/backend system to manage and monitor Kasm workspaces</code>.</p>
<ul>
  <li>A repository has been created, expectaion is to manage main.tf, ec2.tf, etc.</li>
  <li>The repository was built from a Python/Flask backend server template. It will be used for wide variety of Classroom devOps. Terraform special requirements and directory setup is required.</li>
  <li>The <code class="language-plaintext highlighter-rouge">awscli</code> entry has been added to the requirements.txt</li>
</ul>

<p><a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli">Terraform CLI installation reference</a></p>

<p><a href="https://github.com/nighthawkcoders/devOps/blob/main/README.md">Nighthawkcoders DevOps GitHub</a>
<a href="https://github.com/nighthawkcoders/devOps/blob/main/README.md">Nighthawkcoders DevOps GitHub</a></p>

<h4 id="terraform-file-provision">Terraform file provision</h4>
<p>Mostly, configurations identified in the Kasm process are key-value pairs or installation of tools.  Nginx looks a bit different.</p>

<p>The Networking file for Nginx requires <code class="language-plaintext highlighter-rouge">Kasm1</code> to be changed, this is the only difference in configuration per system (Kasm1, Kasm2, …); simply changing  the server_name subdomain.  This could require the use of the <a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/file">Terraform file provisioner feature</a>.  Listed are the template file and steps required for the change.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">server</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">server_name</span><span class="w"> </span><span class="err">Kasm</span><span class="mi">1</span><span class="err">.nighthawkcodingsociety.com;</span><span class="w">
    </span><span class="err">listen</span><span class="w"> </span><span class="mi">80</span><span class="err">;</span><span class="w">

    </span><span class="err">location</span><span class="w"> </span><span class="err">/</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="err">#</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">configurations</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">configured</span><span class="w"> </span><span class="err">when</span><span class="w"> </span><span class="err">proxying</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">Kasm</span><span class="w"> </span><span class="err">Workspaces</span><span class="w">

         </span><span class="err">#</span><span class="w"> </span><span class="err">WebSocket</span><span class="w"> </span><span class="err">Support</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">Upgrade</span><span class="w"> </span><span class="err">$http_upgrade;</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">Connection</span><span class="w"> </span><span class="s2">"upgrade"</span><span class="err">;</span><span class="w">

         </span><span class="err">#</span><span class="w"> </span><span class="err">Host</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">X</span><span class="w"> </span><span class="err">headers</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">Host</span><span class="w"> </span><span class="err">$host;</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">X-Real-IP</span><span class="w"> </span><span class="err">$remote_addr;</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">X-Forwarded-For</span><span class="w"> </span><span class="err">$proxy_add_x_forwarded_for;</span><span class="w">
         </span><span class="err">proxy_set_header</span><span class="w">        </span><span class="err">X-Forwarded-Proto</span><span class="w"> </span><span class="err">$scheme;</span><span class="w">

         </span><span class="err">#</span><span class="w"> </span><span class="err">Connectivity</span><span class="w"> </span><span class="err">Options</span><span class="w">
         </span><span class="err">proxy_http_version</span><span class="w">      </span><span class="mf">1.1</span><span class="err">;</span><span class="w">
         </span><span class="err">proxy_read_timeout</span><span class="w">      </span><span class="mi">1800</span><span class="err">s;</span><span class="w">
         </span><span class="err">proxy_send_timeout</span><span class="w">      </span><span class="mi">1800</span><span class="err">s;</span><span class="w">
         </span><span class="err">proxy_connect_timeout</span><span class="w">   </span><span class="mi">1800</span><span class="err">s;</span><span class="w">
         </span><span class="err">proxy_buffering</span><span class="w">         </span><span class="err">off;</span><span class="w">

         </span><span class="err">#</span><span class="w"> </span><span class="err">Allow</span><span class="w"> </span><span class="err">large</span><span class="w"> </span><span class="err">requests</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">support</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">uploads</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">sessions</span><span class="w">
         </span><span class="err">client_max_body_size</span><span class="w"> </span><span class="mi">10</span><span class="err">M;</span><span class="w">

         </span><span class="err">#</span><span class="w"> </span><span class="err">Endpoint</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">service</span><span class="w">
         </span><span class="err">proxy_pass</span><span class="w"> </span><span class="err">https://localhost:</span><span class="mi">8443</span><span class="err">;</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Nginx configuration file is placed in /etc/nginx/sites-available and then is symbolically linked to /etc/nginx/sites-enabled.</p>
<ul>
  <li>nginx filename: <code class="language-plaintext highlighter-rouge">Kasm1</code></li>
  <li>file path: <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/</code></li>
</ul>

<p>Activate Kasm1 reverse proxy DNS request to Application Endpoint</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> <span class="nt">-f</span> /etc/nginx/sites-enabled/Kasm1
<span class="nb">ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/Kasm1 /etc/nginx/sites-enabled
<span class="nb">sudo </span>systemctl restart nginx
</code></pre></div></div>

<h3 id="security-and-workspace-assignment">Security and Workspace Assignment:</h3>
<p>Kasm images are setup to support each student id and temporary password.  Users of Kasm workspaces are not required to go through AWS identity and management system, they interact with Kasm workspace using Kasm system URL.</p>

<p>Diagram illustrating Kasm Workspaces Login Page</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Browser URL https://Kasm1.nighthawkcodingsociety.com/

Login
---------------          Kasm
| You user ID |          Workspaces
---------------          The Container Streaming Platform
---------------------
| You user Password |
---------------------

</code></pre></div></div>

<h4 id="student-login-management">Student login management</h4>
<p><a href="https://Kasmweb.com/docs/develop/developers/developer_api.html">Kasm Developer API</a> will be used to perform a round-robin assignment of Users to Kasm systems (EC2 instances).  A previously developed user database will be queried to extract a JSON file which will contain unique id (ghid), username, etc.  This JSON data will be sent to a Kasm system using Kasm developer API.   At the end of user creation process, an email to the user with system and login credentials.  At first login, student will be required to reset password.</p>
<ul>
  <li>Kasm API Base Url: https://<kasm_server>/api/public/</kasm_server></li>
  <li>Database/JSON example create user: POST /api/public/create_user
    <pre><code class="language-jsan">{
   "api_key":"",
   "api_key_secret": "",
   "target_user": {
       "username" : "uniquq_ghid",
       "first_name" : "John",
       "last_name" : "M",
       "locked": false,
       "disabled": false,
       "organization": "Del Norte HS",
       "phone": "123-456-7890",
       "password": "TempPassword$"
   }
 }
</code></pre>
  </li>
</ul>

<h4 id="student-database">Student database</h4>
<p>Teacher has a student SQLite database running under Python with GitHub pages frontend.  A Python backend is preferred, over Java, as AWS CLI has a Python BOTO module.  Conversion from SQLite to RDS is trivial after RDS setup is established.</p>

<p>This database with a little modification to SQL schema and Python code, could support maintaining a list of users, APIs and calling Kasm developer APIs.  The Python database currently supports standard CRUD operations that seem to map well to Kasm developer API.  The frontend is managed under GitHub pages, which complies with Themes and their SASS CSS definitions.</p>

<p>APIs will be added to support requests and responses requirements of the Kasm API. This database will maintain the relationship of users to machines, produce reports.  Starter requirements for student database follow …</p>

<ul>
  <li>Report the list of users and Kasm relationship
Illustration of <a href="https://nighthawkcoders.github.io/APCSP/data/database">Users Page</a></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UserID	Name	       Kasm  System  Section Period
toby	Thomas Edison  true  Kasm1   CSSE    2
niko	Nicholas Tesla false desktop CSA     3
hop	    Grace Hopper   true  Kasm2   CSP     1
</code></pre></div></div>

<ul>
  <li>Limit the number of students to a Kasm system
    <ul>
      <li>2 users maximum per period (P1-P5)</li>
      <li>5 total users</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>System  Users P1 P2 P3 P4 P5 Note
Kasm1   5     1  1  1  1  1  ideal config
Kasm2   5     2  2  1  0  0  unbalanced, but OK
Kasm3   5     0  0  0  3  2  not allowed
Kasm4   2     0  0  2  0  0  machine with availability
</code></pre></div></div>

<ul>
  <li>
    <p>Default password and reset to temporary password options</p>
  </li>
  <li>
    <p>Build backend database.  Start with SQLite database, move to RDS as project matures.  To support database work, code starters have been added to Nighthawk coders devOps repo for User table within SQLite database.</p>
  </li>
</ul>

<h4 id="references">References</h4>
<p><a href="https://Kasmweb.com/docs/develop/developers/developer_api.html">Kasm Developer API</a></p>

<p><a href="https://nighthawkcoders.github.io/APCSP/data/database">Teacher Users Page</a></p>

<p><a href="https://github.com/nighthawkcoders/devOps/blob/main/README.md">Nighthawkcoders DevOps GitHub</a></p>

<h3 id="kasm-workspace-architecture">Kasm workspace Architecture:</h3>
<p>Kasm uses Docker to build workspaces and a GitHub registry to store and manage workspaces.  Kasm workspaces start from a GitHub template, the template repository is infused with GitHub Pages actions.  These actions build a user-friendly display of the constructed workspaces in the registry.  Here are some key links to start on the journey of building workspaces within the registry.  The SDLC consist of building Docker and support files, publishing to the registry, installing through the Kasm adminstrative interface on the EC2 instance, and then loading/testing on the Kasm desktop.</p>
<ul>
  <li>Kasm workspace video https://www.youtube.com/watch?v=BGP69_f1wq0</li>
  <li>Kasm Registries video https://www.youtube.com/watch?v=Y6ggn9McIwI</li>
  <li>Be aware that Kasm system, Docker Workpaces must match versions (1.13.1)</li>
  <li>Default Kasm registry link: https://registry.Kasmweb.com/</li>
</ul>

<h4 id="kasm-requires-a-registory-for-workspaces">Kasm requires a Registory for workspaces:</h4>
<p>A Del Norte HS Computer Science Registry in Github has been created.  Multiple locations and references in the repository are important to understand the different aspects of the registry.  The Del Norte HS Computer Science Registry and its Kasm workspaces need to be developed to meet the needs of CSSE, CSP, and CSA classes.  However, this work can be done asynchronously to the Terraform automation plan.</p>

<ul>
  <li>Registry link: https://nighthawkcoders.github.io/Kasm_registry/.  This link is placed into adminstrative workspaces on the Kasm1 to KasmN machines.  Deployment can occur directly from a GitHub commit straight into the registered workspace, across many machines at once.  Branching or Forking should be employed to avoid accidental deployments.  But, the feature are in the system for success.  As a strategy, a forked repo/registry could be used to manage test, then a pull request after testing could trigger production repo/registry update.</li>
  <li><a href="https://github.com/nighthawkcoders/Kasm_registry/blob/1.0/site/next.config.js">Registry Config file</a>.  This is setup correctly for this projects purposes, but you should be aware that it is required for GitHub Pages.  If registry is changed to nighthawkcodingsocity.com subdomain, then this file will need to be revised.</li>
  <li><a href="https://github.com/nighthawkcoders/Kasm_registry">GitHub for Registry</a>.  This contains the README for valuable information on setup and development.  A Kasm workspace/docker developer would spend time here customizing code to support user requirements.  Version Control for Docker workspaces is built into the Kasm registry and requirements should be learned from their materials and experience.</li>
  <li><a href="https://nighthawkcoders.github.io/Kasm_registry/1.0/">GitHub Pages for Registry</a>.  This is a pretty view of the workspaces in the registry. The Kasm workspace registry is professionally designed, it has versions built into the URLs.  By cursory review you could maintain 1.0 and 1.1 workspaces at the same time, to allow soft transitions to updates. GitHub Task collaboration was placed into each workspace allow adminstrators and users to add issues directly into GitHub.  Tracking changes, and managing containerized desktops is built into the Kasm tools.</li>
</ul>

<h4 id="kasm-workspaces-docker-layout">Kasm workspaces Docker layout</h4>
<p>This below Docker file follows the Kasm format with the required head and tail sections; all customizations must be done in between.  This shows setup starters for some of our required tools.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Chrome</code> is added in this script.  This was not included in bash script but is essential to GitHub Pages code-build-test-debug development lifecycle.</li>
  <li><code class="language-plaintext highlighter-rouge">VSCode</code> is shown below.  In this example it is sourcing a directory installed by the Kasm image.  Customizing our Kasm image can make installation process much easier.</li>
  <li><code class="language-plaintext highlighter-rouge">Anaconda</code> is show below.  In this example you can see similarities in installation as compared to the script above.  Of course, we should switch our implementation to <code class="language-plaintext highlighter-rouge">Miniconda</code> to save space and avoid large GUI application which could impact our memory footprint.  As with VSCode, we could fully manage a version of this package within our Kasm image to minimize Docker complexities.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">FROM</span> <span class="n">Kasmweb</span><span class="o">/</span><span class="n">core</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">-</span><span class="n">focal</span><span class="p">:</span><span class="mf">1.13</span><span class="p">.</span><span class="mi">1</span>
<span class="n">USER</span> <span class="n">root</span>
<span class="n">ENV</span> <span class="n">HOME</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">Kasm</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">profile</span>
<span class="n">ENV</span> <span class="n">STARTUPDIR</span> <span class="o">/</span><span class="n">dockerstartup</span>
<span class="n">ENV</span> <span class="n">INST_SCRIPTS</span> <span class="err">$</span><span class="n">STARTUPDIR</span><span class="o">/</span><span class="n">install</span>
<span class="n">ENV</span> <span class="n">CONDA_DIR</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span>
<span class="n">ENV</span> <span class="n">PATH</span> <span class="err">$</span><span class="n">CONDA_DIR</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">WORKDIR</span> <span class="err">$</span><span class="n">HOME</span>

<span class="c1">######### Customize Container Here ###########
# Install Google Chrome
</span><span class="n">COPY</span> <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="n">chrome</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span>
<span class="n">RUN</span> <span class="n">bash</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span><span class="n">install_chrome</span><span class="p">.</span><span class="n">sh</span>  <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span>
<span class="c1"># Install VSCode
</span><span class="n">COPY</span> <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="n">vs_code</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">vs_code</span><span class="o">/</span>
<span class="n">RUN</span> <span class="n">bash</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">vs_code</span><span class="o">/</span><span class="n">install_vs_code</span><span class="p">.</span><span class="n">sh</span>  <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="err">$</span><span class="n">INST_SCRIPTS</span><span class="o">/</span><span class="n">vs_code</span><span class="o">/</span>
<span class="c1"># Install Anaconda
</span><span class="n">RUN</span> <span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="p">.</span><span class="n">anaconda</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">Anaconda3</span><span class="o">-</span><span class="mf">2023.07</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="p">.</span><span class="n">sh</span> \
    <span class="o">&amp;&amp;</span> <span class="n">bash</span> <span class="n">Anaconda3</span><span class="o">-</span><span class="mi">20</span><span class="o">*-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span> \
    <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">Anaconda3</span><span class="o">-</span><span class="mi">20</span><span class="o">*-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="p">.</span><span class="n">sh</span> \
    <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="err">‘</span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span><span class="err">’</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">bash</span><span class="p">.</span><span class="n">bashrc</span> \
    <span class="o">&amp;&amp;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="err">“</span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span> \
        <span class="o">&amp;&amp;</span> <span class="n">conda</span> <span class="n">update</span> <span class="o">-</span><span class="n">n</span> <span class="n">root</span> <span class="n">conda</span>  \
        <span class="o">&amp;&amp;</span> <span class="n">conda</span> <span class="n">update</span> <span class="o">--</span><span class="nb">all</span> \
        <span class="o">&amp;&amp;</span> <span class="n">conda</span> <span class="n">clean</span> <span class="o">--</span><span class="nb">all</span><span class="err">”</span> \
    <span class="o">&amp;&amp;</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">ssl_verify</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="p">.</span><span class="n">crt</span> \
    <span class="o">&amp;&amp;</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">conda</span> <span class="n">install</span> <span class="n">pip</span> \
    <span class="o">&amp;&amp;</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">Kasm</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="p">.</span><span class="n">pip</span> \
    <span class="o">&amp;&amp;</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">Kasm</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">profile</span><span class="o">/</span><span class="p">.</span><span class="n">conda</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">jupyter</span>
<span class="c1">######### End Customizations ###########
</span>
<span class="n">RUN</span> <span class="n">chown</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">0</span> <span class="err">$</span><span class="n">HOME</span>
<span class="n">RUN</span> <span class="err">$</span><span class="n">STARTUPDIR</span><span class="o">/</span><span class="n">set_user_permission</span><span class="p">.</span><span class="n">sh</span> <span class="err">$</span><span class="n">HOME</span>
<span class="n">ENV</span> <span class="n">HOME</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">Kasm</span><span class="o">-</span><span class="n">user</span>
<span class="n">WORKDIR</span> <span class="err">$</span><span class="n">HOME</span>
<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">HOME</span> <span class="o">&amp;&amp;</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">0</span> <span class="err">$</span><span class="n">HOME</span>
<span class="n">USER</span> <span class="mi">1000</span> <span class="p">(</span><span class="n">edi</span>
</code></pre></div></div>

<h4 id="kasm-workspaces-have-tool-requirements">Kasm workspaces have tool requirements</h4>
<p>The provided shell script has been used in the classroom to install and verify tools on the user’s desktop. This is a good requirements guide for tools required for our Kasm workspace. The classroom workspace in the registry needs to support all tools for the code-build-test-debug development lifecycle.</p>

<p>Key thing to test in Kasm workspace…</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">make</code> on teacher or student repositories.  The runs <code class="language-plaintext highlighter-rouge">bundle exec jekyll serve</code> which helps validate ruby tool chain.  This is the priority use case for August 16th.</li>
  <li><code class="language-plaintext highlighter-rouge">github commit and sync</code> be sure git operations are working and environment is or can be set.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.email &lt;your email&gt;
git config <span class="nt">--global</span> user.name &lt;your github <span class="nb">id</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">sudo apt</code>, if this can’t be used then tools need to be comprehensive.</li>
  <li><code class="language-plaintext highlighter-rouge">docker-compose up</code> this would be running Docker inside of Docker, but is in procedure to test locally prior to deployment.  This can be tested with flask_portfolio or spring_portfolio repositories</li>
  <li><code class="language-plaintext highlighter-rouge">code flask_portfolio</code> run python web project.  Specifically running python and doing pip installs and making sure VSCode python interpreter and shell interpreter are synchronized.</li>
  <li><code class="language-plaintext highlighter-rouge">code spring_portfolio</code> running a web java project.  Make sure we can get java version to support this task.</li>
  <li><code class="language-plaintext highlighter-rouge">workspace preservation</code> login / logout, shutdown workspace, evaluate persistence.</li>
</ol>

<p>The key concept in building a Docker workspace is understanding order and depenendies.  That is illustrated in setup order within the script below…</p>
<ul>
  <li><a href="https://code.visualstudio.com/docs/setup/linux">Install VSCode</a>.  The install_vscode() function illustrates download requirements and installation depencies.</li>
  <li><a href="https://www.ruby-lang.org/en/documentation/installation/">Install Ruby</a>. The install_ruby() script is convention for Ubuntu command line installation.</li>
  <li><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/linux.html">Install MiniConda</a> The install_miniconda() shows this requires fetch and execute, it is not shown as working with apt.</li>
  <li><code class="language-plaintext highlighter-rouge">Developer Tools</code> The install_dev_tools() script highlights things that need to be on machine to support local build environments.  Some of these are missing on our Kasm test environments.</li>
  <li><code class="language-plaintext highlighter-rouge">Conda Environment</code> The setup_conda_environment() shows that ~/.bashrc needs to be updated to assist our development.  For instance, if GEM lines are not in conda environment bundle install will overwrite system files at each user execution.</li>
  <li><code class="language-plaintext highlighter-rouge">Dev Tools in Conda</code> The install_dev_tools_in_conda() shows tools that should be setup after conda environment is activated.  This avoids issues or conflict with system.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/bin/bash
</span>
<span class="c1"># Function to check if a line exists in the .bashrc file
</span><span class="n">line_exists_in_bashrc</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">grep</span> <span class="o">-</span><span class="n">Fxq</span> <span class="err">“$</span><span class="mi">1</span><span class="s">" ~/.bashrc
}
# Function to add lines to the .bashrc file if they don’t exist
add_to_bashrc() {
  if ! line_exists_in_bashrc “$1”; then
    echo “$1"</span> <span class="o">&gt;&gt;</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span>
  <span class="n">fi</span>
<span class="p">}</span>
<span class="c1"># Function to install Visual Studio Code
</span><span class="n">install_vscode</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="err">!</span> <span class="n">command</span> <span class="o">-</span><span class="n">v</span> <span class="n">code</span> <span class="o">&amp;&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Installing</span> <span class="n">Visual</span> <span class="n">Studio</span> <span class="n">Code</span><span class="p">...</span><span class="err">”</span>
    <span class="c1"># Add VSCode repository and key
</span>    <span class="n">wget</span> <span class="o">-</span><span class="n">qO</span><span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">packages</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">keys</span><span class="o">/</span><span class="n">microsoft</span><span class="p">.</span><span class="n">asc</span> <span class="o">|</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">dearmor</span> <span class="o">&gt;</span> <span class="n">packages</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">gpg</span>
    <span class="n">sudo</span> <span class="n">mv</span> <span class="n">packages</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">gpg</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">trusted</span><span class="p">.</span><span class="n">gpg</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">microsoft</span><span class="p">.</span><span class="n">gpg</span>
    <span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="err">‘</span><span class="n">echo</span> <span class="err">“</span><span class="n">deb</span> <span class="p">[</span><span class="n">arch</span><span class="o">=</span><span class="n">amd64</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">packages</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">vscode</span> <span class="n">stable</span> <span class="n">main</span><span class="err">”</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="p">.</span><span class="nb">list</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vscode</span><span class="p">.</span><span class="nb">list</span><span class="err">’</span>
    <span class="c1"># Update package index and install VSCode
</span>    <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
    <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">code</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Visual</span> <span class="n">Studio</span> <span class="n">Code</span> <span class="n">installed</span> <span class="n">successfully</span><span class="p">.</span><span class="err">”</span>
  <span class="k">else</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Visual</span> <span class="n">Studio</span> <span class="n">Code</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">installed</span><span class="p">.</span><span class="err">”</span>
  <span class="n">fi</span>
<span class="p">}</span>
<span class="c1"># Function to install ruby
</span><span class="n">install_ruby</span><span class="p">()</span> <span class="p">{</span>
<span class="c1"># Check if ruby command is available
</span>  <span class="k">if</span> <span class="err">!</span> <span class="n">command</span> <span class="o">-</span><span class="n">v</span> <span class="n">ruby</span> <span class="o">&amp;&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Installing</span> <span class="n">Ruby</span><span class="p">...</span><span class="err">”</span>
    <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
	  <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ruby</span><span class="o">-</span><span class="n">full</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span>
  <span class="k">else</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Ruby</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">installed</span><span class="p">.</span><span class="err">”</span>
  <span class="n">fi</span>
<span class="p">}</span>
<span class="c1"># Function to install MiniConda and Build environment
</span><span class="n">install_miniconda</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="err">!</span> <span class="n">command</span> <span class="o">-</span><span class="n">v</span> <span class="n">conda</span> <span class="o">&amp;&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">Installing</span> <span class="n">MiniConda</span><span class="p">...</span><span class="err">”</span>
    <span class="c1"># Download MiniConda installer
</span>    <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="p">.</span><span class="n">anaconda</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">Miniconda3</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">O</span> <span class="o">~/</span><span class="n">miniconda</span><span class="p">.</span><span class="n">sh</span>
    <span class="c1"># Install MiniConda
</span>    <span class="n">bash</span> <span class="o">~/</span><span class="n">miniconda</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">miniconda</span>
    <span class="n">rm</span> <span class="o">~/</span><span class="n">miniconda</span><span class="p">.</span><span class="n">sh</span>
  <span class="k">else</span>
    <span class="n">echo</span> <span class="err">“</span><span class="n">MiniConda</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">installed</span><span class="p">.</span><span class="err">”</span>
  <span class="n">fi</span>
<span class="p">}</span>

<span class="c1"># Common Developer tools for system
</span><span class="n">install_dev_tools</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="err">“</span><span class="n">Installing</span> <span class="n">Developer</span> <span class="n">Tools</span><span class="p">...</span><span class="err">”</span>

  <span class="c1"># Common GNU tools
</span>  <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span>
  <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">make</span>

  <span class="c1"># Install Jekyll Development tools
</span>  <span class="n">gem</span> <span class="n">install</span> <span class="n">jekyll</span> <span class="n">bundler</span>
<span class="p">}</span>

<span class="c1"># The environment_activate function effectively sets up the required environment configurations by adding lines to the .bashrc file only if they don’t already exist. This ensures that the modifications to the .bashrc file are performed only once and avoids duplication.
</span><span class="n">setup_conda_environment</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">add_to_bashrc</span> <span class="sb">`# local environment requirement`</span>
  <span class="n">add_to_bashrc</span> <span class="err">‘</span><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">“$</span><span class="n">HOME</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span><span class="err">”’</span>
  <span class="n">add_to_bashrc</span> <span class="err">‘</span><span class="n">export</span> <span class="n">GEM_HOME</span><span class="o">=</span><span class="err">“$</span><span class="n">HOME</span><span class="o">/</span><span class="n">gems</span><span class="err">”’</span>
  <span class="n">add_to_bashrc</span> <span class="err">‘</span><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">“$</span><span class="n">HOME</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span><span class="err">”’</span>
  <span class="n">conda</span> <span class="n">init</span> <span class="n">bash</span>
<span class="p">}</span>

<span class="c1"># Specific Developer tools for GitHub Pages and Jupyter Notebooks
</span><span class="n">install_dev_tools_in_conda</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="err">“</span><span class="n">Activate</span> <span class="n">conda</span><span class="err">”</span>
  <span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span>

  <span class="c1"># Install Jupyter Development tools and nbconvert
</span>  <span class="n">echo</span> <span class="s">"Installing Jupyter Notebooks and nbconvert..."</span>
  <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">n</span> <span class="n">base</span> <span class="o">-</span><span class="n">y</span> <span class="n">jupyter</span> <span class="n">nbconvert</span>
<span class="p">}</span>

<span class="c1"># Main script
</span><span class="n">install_vscode</span>
<span class="n">install_ruby</span>
<span class="n">install_miniconda</span>
<span class="n">install_dev_tools</span>
<span class="n">setup_conda_environment</span>
<span class="n">install_dev_tools_in_conda</span>
</code></pre></div></div>

<h2 id="tbd-plans">TBD Plans</h2>
<p>Key items to add to this plan.</p>

<h3 id="web-filtering-policy">Web Filtering Policy</h3>
<p>Kasm Workspaces built in Web Filtering configuration. Choose web content to black and whitelist based on URLs and Domain categorization: https://kasmweb.com/docs/latest/guide/web_filtering.html.</p>

<h3 id="user-database-security-and-feature">User Database Security and Feature</h3>
<p>Add security to Web Database.</p>

<ul>
  <li>User owner and Admin are only roles with rights to edit user identity</li>
  <li>Perform more detail analytics on Users, both around Kasm and around GitHub</li>
</ul>

<h3 id="review-aws-security">Review AWS Security:</h3>
<p>Adding a section on security to describe roles on AWS.</p>

<ul>
  <li>
    <p>IAM Roles: Define the IAM roles and policies required for different user types, such as administrators, teacher. developers, and students. Ensure that each role has the least privilege necessary for their tasks.</p>
  </li>
  <li>
    <p>Best Practices: AWS security best practices related to IAM, access keys, password policies, …</p>
  </li>
  <li>
    <p>Currently blocking AWS <code class="language-plaintext highlighter-rouge">student</code> group from us-east-1, us-west-1, us-west-2.  These regions will be reserved to teachers and those that adminstrate machines.</p>
  </li>
</ul>

<p>JSON that shows Allow Ohio, Deny all other regions.  This was basis used to block student roles.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"NotAction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2:*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"StringNotEqualsIfExists"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"aws:RequestedRegion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-east-2"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="terraform-life-cycle">Terraform Life Cycle:</h3>
<p>Include version control, test plan, and deployment plan for Terraform scripts:</p>

<ul>
  <li>
    <p>Version Control: Explain how you will manage your Terraform code using version control systems like Git/GitHub, and how you will udates, forks, and merging.</p>
  </li>
  <li>
    <p>Test Plan: Describe your testing strategy, including unit tests, integration tests, and end-to-end tests for the Terraform scripts. Specify how you will validate the correctness of the infrastructure.</p>
  </li>
  <li>
    <p>Deployment Plan: Outline the steps for deploying the Terraform scripts to the test environment first, and how you will promote them to the production environment after successful testing.  Make sure test environments are temporary and torn down quickly after validation save costs.</p>
  </li>
</ul>

<h3 id="investage-and-move-to-kasm-multi-server">Investage and move to Kasm multi-server</h3>
<p>Bypass limitations on AWS elastic IP and user larger servers.</p>

<ul>
  <li>Move user home directories to S3 Buckets</li>
  <li>Start migration and development on new solutions: https://kasmweb.com/docs/latest/install/multi_server_install.html</li>
  <li>Enter into per user licensing with Kasm</li>
</ul>


  </div><a class="u-url" href="/teacher_portfolio/devops/cloud_workspace" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/teacher_portfolio/"></data>
  
    <div class="wrapper">
  
      <div class="footer-col-wrapper">
  
        <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/nighthawkcoders/teacher_portfolio" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/teacher_portfolio/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://x.com/NighthawkCoding/" target="_blank" title="x">
    <svg class="svg-icon grey">
      <use xlink:href="/teacher_portfolio/assets/minima-social-icons.svg#x"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.youtube.com/@nighthawkcodingsociety2868" target="_blank" title="youtube">
    <svg class="svg-icon grey">
      <use xlink:href="/teacher_portfolio/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>
</ul>
</div>

      </div>
    </div>
  
  </footer></body>

</html>
